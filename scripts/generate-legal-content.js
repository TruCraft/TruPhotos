#!/usr/bin/env node

/**
 * Script to generate TypeScript constants from LICENSE and PRIVACY.md files
 * This ensures the legal documents are embedded in the app without duplication in source code
 */

const fs = require('fs');
const path = require('path');

// Paths
const rootDir = path.join(__dirname, '..');
const licenseFile = path.join(rootDir, 'LICENSE');
const privacyFile = path.join(rootDir, 'PRIVACY.md');
const outputFile = path.join(rootDir, 'src', 'constants', 'legalContent.ts');

// Read the files
console.log('üìÑ Reading legal documents...');

let licenseContent = '';
let privacyContent = '';

try {
  licenseContent = fs.readFileSync(licenseFile, 'utf8');
  console.log('‚úÖ LICENSE file read successfully');
} catch (error) {
  console.error('‚ùå Error reading LICENSE file:', error.message);
  process.exit(1);
}

try {
  privacyContent = fs.readFileSync(privacyFile, 'utf8');
  console.log('‚úÖ PRIVACY.md file read successfully');
} catch (error) {
  console.error('‚ùå Error reading PRIVACY.md file:', error.message);
  process.exit(1);
}

// Escape backticks and backslashes for template literals
const escapeLiteral = (str) => {
  return str
    .replace(/\\/g, '\\\\')  // Escape backslashes
    .replace(/`/g, '\\`')     // Escape backticks
    .replace(/\$/g, '\\$');   // Escape dollar signs
};

// Generate TypeScript file content
const tsContent = `/**
 * AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
 * 
 * This file is automatically generated from LICENSE and PRIVACY.md
 * Run 'npm run generate:legal' to regenerate
 * 
 * Generated on: ${new Date().toISOString()}
 */

export const LICENSE_TEXT = \`${escapeLiteral(licenseContent)}\`;

export const PRIVACY_POLICY = \`${escapeLiteral(privacyContent)}\`;
`;

// Ensure the constants directory exists
const constantsDir = path.dirname(outputFile);
if (!fs.existsSync(constantsDir)) {
  fs.mkdirSync(constantsDir, { recursive: true });
  console.log('üìÅ Created constants directory');
}

// Write the output file
try {
  fs.writeFileSync(outputFile, tsContent, 'utf8');
  console.log('‚úÖ Generated:', outputFile);
  console.log('üéâ Legal content constants generated successfully!');
} catch (error) {
  console.error('‚ùå Error writing output file:', error.message);
  process.exit(1);
}

